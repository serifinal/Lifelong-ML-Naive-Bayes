<Thread>
	<Post id="0" class="0">
		<Title>ATI Radeon HD 4600 & 4800 series support 7.1 channel HDMI audio!</Title>
		<Username>renethx</Username>
		<Datetime>05-15-08, 09:15 AM</Datetime>
		<Content>Last Updated on March 13th, 2009 Table of Contents ATI Radeon HD 4800 SeriesSupports Multichannel LPCM HDMI Audio, Up To 7.1 channel/32 bit/192 kHz Audio Downsampled to 16 bit, 48 kHz by Commercial BD Players Specifications 3D Performance Availability and Prices Enabling HDMI Audio &#8211; You Need the "ATI HDMI Audio Device" Driver!!The ATI Proprietary DVI-HDMI Adapter Download and Install "ATI HDMI Audio Device" Driver Configure the Sound Dialog Box Configure PowerDVD/TotalMedia Theater Managing 5.1 Channel Sources with 7.1 Channel Speakers Bit Perfect Sounds by WASAPI Exclusive Mode Current Solutions for Multichannel LPCM HDMI Audio Protected Audio Path (PAP)Audio from Premium Contents Downsampled to 16bit/48kHz without PAP! Another Reason for Downsampling: Player Bug PUMA and PAP Hardware and Software player Must Work Together Protected Video Path (PVP) HDMI Sound Cards &#8211; Proprietary PAP SolutionsAuzentech X-Fi HomeTheater HD and CyberLink PowerDVD ASUS Xonar HDAV1.3 and ArcSoft TotalMedia Theater MKV and FLAC &#8211; A Solution for Full-Resolution Audio without PAP _______________________ ATI Radeon HD 4800 Series ??????????????????????? Supports Multichannel LPCM HDMI Audio, Up To 7.1 channel/32 bit/192 kHz According to a couple of sources, the upcoming ATI Radeon HD 4800 Series graphics cards will support multichannel LPCM HDMI audio (actually up to 7.1 channel/32 bit/192 kHz). For example, - TG Daily - ATI Radeon 4800 launch details: Meet (Terry) Makedon and Trojan (Horse) (May 14, 2008) Quote: The Radeon 4800 series also includes 7.1 channel-via-HDMI support - Tom's Hardware - &#26377;&#22294;&#26377;&#30495;&#30456;&#65281;AMD/ATI Radeon HD 4800&#31995;&#21015;&#29031;&#29255;&#26333;&#20809; (May 26, 2008) Audio Downsampled to 16 bit, 48 kHz by Commercial BD Players However it is unclear if HD 4800 series supports PAP or not. Without PAP, audio from every AACS-encrypted content will be downsampled to 16 bit, 48 kHz. Surely the cards will not support Dolby TrueHD/DTS-HD Master Audio bitstreams. Specifications The below is data of the cards collected in February (so may not be correct): Source: - AMD to launch Radeon HD 4000 series in June? - RV770, RV740 AND RV710 VIDEO CHIP For your reference 3D Performance Basically GeForce 8800 GT (= 9800 GT) < Radeon HD 4850 < GeForce 9800 GTX < Radeon HD 4870 = GeForce GTX 260 < GeForce 9800 GX2 Availability and Prices - HD 4850 (RV770 PRO): $199, released on June 18, 2008 - HD 4870 (RV770 XT): $299, released on June 25, 2008 RV730 and RV710 to launch in September - HD 4670 (RV730 XT): $79, released on September 10, 2008 - HD 4650 (RV730 PRO): $69, released on September 10, 2008 - HD 4550 (RV710 XT): $39-$49 (256MB), $49-$59 (512MB), released on September 30, 2008 - HD 4350 (RV710 PRO) ___________________________________________________________ Enabling HDMI Audio &#8211; You Need the "ATI HDMI Audio Device" Driver!! ??????????????????????????????????????????????????????????? The ATI Proprietary DVI-HDMI Adapter Enabling HDMI audio in a Radeon HD 4xxx card is a bit confusing. First you have to use the ATI proprietary DVI-HDMI adapter (unless your card has a native HDMI connector). Otherwise you won't get audio through HDMI. The adapter is sometimes bundled with the card. If your card does not come with the adapter, you have to buy it, for example, from here. Download and Install "ATI HDMI Audio Device" Driver You will need to install not only ATI Radeon Video Card Driver, but also ATI HDMI Audio Device driver. - If you are a Windows XP user, then download the ATI HDMI Audio Driver from the AMD website. - If you are a Windows Vista/7 user, then download the ATI HDMI Audio Driver from the Realtek website. (Why Realtek? A reasonable guess is that ATI lacks proper audio technology and ATI relies on Realtek for the whole audio part of the GPU.) Configure the Sound Dialog Box After you installed the driver, you have to enable the ATI HDMI audio device in the Sound dialog box. Here are some screenshots of the dialog box. First you have to select the correct playback device: Realtek HDMI Output. (The motherboard was GA-E7AUM-DS2H GeForce 9400 mGPU, so you can see "NVIDIA HDMI Output" too [disabled because an NVIDIA GPU can't work simultaneously with an ATI card under Vista].) Click the "Configure" button and open "Speaker Setup". Then select the correct speaker setting. Click the "Properties" button and click the "Supported Formats" tab, where you can select supported formats. Click the Test button and select all the supported formats. In the "Advanced" tab, select the sample rate and bit depth. Vista Audio Engine will downsample/upsample audio to that sample rate/bit depth. So you should choose the highest rate/depth here. Configure PowerDVD/TotalMedia Theater PowerDVD 8 Ultra DD/DTS pass-through: - Speaker environment > Use HDMI - Output mode > AC3/DTS pass-through Multichannel PCM (including the one decoded from HD audio codecs/DD/DTS): - Speaker environment > Use HDMI - Output mode > PCM output or - Speaker environment > 6 speaker (or 8 speaker) - Output mode > No effect (or whatever effect you like) TotalMedia Theater DD/DTS pass-through: - Audio Output Mode > S/PDIF Multichannel PCM (including the one decoded from HD audio codecs/DD/DTS) - Audio Output Mode > 5.1 Channels (or 7.1 Channels) Managing 5.1 Channel Sources with 7.1 Channel Speakers Suppose that you use a 7.1 speaker system and select "7.1 Surround" in the Sound dialog box. This is fine as long as you play 7.1 audio sources. Howerver, when you play a 5.1 audio source, there will be no side or rear (depending on your player) surround sounds and you can't upconvert 5.1 to 7.1 using, for example, Dolby Pro Logic IIx, in your receiver (as the receiver gets mute signals for the side or rear surround speakers). A workaround is switch between "7.1 Surround" and "5.1 Surround" according to the numbe of channels in the audio source and then upconvert 5.1 to 7.1 in your receiver for a 5.1 source. This can be done by hotkeys. Another easier workaround is use Dolby Pro Logic IIx built in PowerDVD (the picture below) and use Custom matrix in the Mixer tab of ffdshow Audio Decoder for DirectShow players. If you set Mixer as is, the source FrontL, Center, FrontR, BackL, BackR, LFE (subwoofer) is mapped into the speaker FrontL, Center, FrontR, BackL, BackR, LFE (subwoofer) respectively. SpeakerFrontLCenterFrontRSideLSideRBackLBackRLFE SourceFrontLCenterFrontR--BackLBackRLFE TargetFrontLCenterFrontR--BackLBackRLFE You can use "Custom matrix" so that SideL speaker is a mixture of SideL and BackL, and SideR speaker is a mixture of SideR and BackR. For a 5.1 source, you will hear BackL from both of the SideL speaker and the BackL speaker. For a 7.1 source, you will hear SideL+BackL from the SideL speaker (you will need to compromise). SpeakerFrontLCenterFrontRSideLSideRBackLBackRLFE SourceFrontLCenterFrontRSideLSideRBackLBackRLFE TargetFrontLCenterFrontRSideL+BackLSideR+BackRBackLBackRLFE _____________________________________ Bit Perfect Sounds by WASAPI Exclusive Mode ????????????????????????????????????? Here bit perfect audio means audio streaming bypassing Windows Vista Audio Engine, thus no other application's audio will play and signal processing has no effect. This is achieved when the audio renderer selects the WASAPI (Windows Audio Session API) exclusive mode (as opposed to the shared mode). Basic flow of audio streams is Shared mode: Audio source -> Decoder -> DS Renderer -> WASAPI -> Audio Engine -> Audio driver -> HDMIExclusive mode: Audio source -> Decoder -> ReClock -> WASAPI -> Audio driver -> HDMIUnfortunately there are only a couple of players/renderers that support the WASAPI exclusive mode, and for movie playback, ReClock (since 1.8.3.7) is the only solution right now. Please read WASAPI Support for details of ReClock WASAPI support. Here are tables summarizing supported audio formats in the WASAPI exclusive mode with ReClock and foobar2000+WASAPI output plug-in. I tested with various stereo/5.1/7.1 channel, 16/24 bit, 44.1/48/96/192 kHz, FLAC and WAV files. HDMI audio driver is R2.18. ReClock 44.1 kHz48 kHz96 kHz192 kHz16 bitYYYY24 bitNNNN32 bitYYYY32 bit IEEE floatNNNNfoobar2000 44.1 kHz48 kHz96 kHz192 kHz8 bitNNNN16 bitYYYN24 bitYYYN32 bitNNNNRemarks - "Buffer Length" in foobar2000 needs to be < ~900 ms. - DTS on WAV is supported only when Stereo is selected in the "Sound" dialog box of the Windows control panel for both ReClock and foobar2000. Read the thread ATI 45xx, Bit perfect, and Vista. ___________________________________________ Current Solutions for Multichannel LPCM HDMI Audio ??????????????????????????????????????????? So we have plenty of choices for multichannel LPCM over HDMI: IGP - Intel G965, G33 and G35 with SDVO HDMI device (since 2006) - Intel G45 - GeForce 8200 & 8300, nForce 750a & 780a SLI mGPU for AMD - GeForce 9300 & 9400 mGPU for Intel Discrete Graphics Card - ATI Radeon HD 4350/4550/4600 Series/4800 Series All the above solutions lack PAP (and software) hence, audio from premium contents is downsampled to 16bit/48kHz. None of them supports Dolby TrueHD and DTS-HD Master Audio bitstreaming. Sound Card - ASUS Xonar HDAV1.3 - Auzentech Auzen X-Fi HomeTheater HD They are the only solutions that supports full-resolution LPCM and Dolby TrueHD and DTS-HD Master Audio bitstreaming. _______________________ Protected Audio Path (PAP) ??????????????????????? Audio from Premium Contents Downsampled to 16bit/48kHz without PAP! The support for multichannel LPCM is only half of the story, however. Protected Audio Path (PAP) is essential for full resolution audio, without which audio from every AACS-encrypted content will be downsampled to 16bit/48kHz. PAP is also necessary for Dolby TrueHD / DTS-HS Master Audio bitstreams. Quote: A Licensed Player shall not pass, or direct to be passed Decrypted AACS Content to a digital output except: 1.4.1 A digital output of audio, or of the audio portion of other forms of Decrypted AACS Content, in compressed audio format (such as AC3) or in Linear PCM format in which the transmitted information is sampled at no more than 48 kHz and no more than 16 bits. 1.4.2 An output delineated in Table D1, AACS Authorized Digital Outputs, in accordance with any associated restrictions and obligations specified therein; Another Reason for Downsampling: Player Bug Non-premium contents need not be downsampled, but as a matter of fact are downsampled to 16-bit/48kHz by PowerDVD. This a bug CyberLink acknowledged (bit-tech - PowerDVD audio downsampling explained (by Richard Swinburne; October 8, 2007)). Quote: When asked why PowerDVD downsamples HD audio from both Blu-ray and HD DVD discs to 48KHz / 16-bit, Chen responded by saying that "digital output without protection is not possible due to AACS requirement. Digital and analogue output with protection (HDMI) is also not possible due to lack of an internal secure audio path in a Windows PC." "We are currently working with Realtek to support their proprietary interface for encryption of audio bus. Once completed, we will not longer need to downsample the audio. This will be provided for free to end-user for upgrade." This didn't really clear up the downsampling situation though because, as far as we're aware all audio, regardless of encryption, is downsampled. We therefore pressed Chen to clear up the speculation. "I think this is a mistake," he said, "we never intended to pass this message. I think there might be some bug in our program that downsamples everything. That is not our intent. We only need to down-sample premium content (AACS, CPRM, etc)." This prompted us to ask whether there is a requirement for AACS in a PC when a disc or file is not encrypted. Chen told us that the unencrypted scenario is not mandated by AACS so shouldn't be included in the downsampling. We inquired further about the "secure internal audio path": is this because of Microsoft not providing one and/or sound card companies not providing a compatible driver? Chen informed us that there isn't an industry standard (defined by Microsoft or someone else) that makes the encryption/decryption path between software and audio driver secure. CyberLink have to enable one chip after another which takes a considerable amount of time working with sound card providers, Microsoft and checking that it satisfies the AACS mandate. The above bug applies to not only 7.3 but also 8 (bit-tech - CyberLink PowerDVD 8 & Media Show 4 (by Richard Swinburne; March 24, 2008)). Quote: The lossless audio support that we first covered a while back has been put back to the release of 8.5 at around the August-September time frame. Again, CyberLink was keen to stress that this will be a free update if you already own PowerDVD 8. This delay can be significant issue for those wanting to use PowerDVD 8 with Blu-ray disks, but after discussing this with both Dolby (TrueHD) and CyberLink, as well as various motherboard vendors (Gigabyte boards that use the Realtek ALC889a and features &#8220;content protection&#8221;) and even AMD (in reference to its 780G and its audio limitation to S/PDIF pass-through under HDMI) during CeBIT, all we can conclude is that HDCP for full quality audio is just a complete mess. BTW "a free update" is questionable because there may not be "PowerDVD 8.5": bit-tech - CyberLink to launch new TrueTheatre technologies (by Richard Swinburne; May 30, 2008). Quote: Another thing worth noting though is that PowerDVD 9 (formerly 8.5) will be available in a Q3 to Q4 timeframe this year PUMA and PAP If you are interested in PAP, the following document will be helpful to understand the current situation. - Output Content Protection and Windows Vista (April 27, 2005) Quote: 4 Protected User Mode Audio: PUMA 4.3 PUMA (Protected User Mode Audio) Security Architecture This section examines the components in the PUMA engine concerned with security. Aside from the Virtual Audio Server (VAS) receiving component, the PUMA architecture includes three protection-related component types of interest: Virtual Protected Output (VPO) module Protected Output Controller (POC) Output Encryption Audio Processing Object (APO) 4.3.2 Output Encryption APO The Output Encryption APO is the module that will provide encryption of the audio data, if it becomes necessary in the future. For the initial release of Windows Vista, it is planned that just the interfaces to the module will exist, rather than any actual modules. The planned implementation is that the audio system will request an Output Encryption APO from the POC. The audio policy will set up the audio engine such that the Output Encryption APO will be called as the last processing element for the audio data, before the data is passed to the driver. This allows the Output Encryption APO to encrypt the data according to the current protection policy. The POC will choose to not load an Output Encryption APO if encryption is not necessary (which it isn&#8217;t in 2006). 4.7 PCIe Bus and PUMA In the same way as with video, the PCIe bus could become a problem for premium audio, because content owners might regard it as a user-accessible bus. The issue affects the use of a discrete audio card or a discrete graphics card that has audio capabilities. While there might not be many discrete audio cards in 2006, there more than likely will be HDMI discrete graphics cards that have HD Audio controllers. The important scenario is the play back of HD-DVDs and Blu-Ray DVDs. In this case, the video is considered premium and the audio may also be. There is no problem with the video, because PVP-UAB (Protected Video Path - User Accessible Bus) protects the video over the PCIe bus, but there is currently no equivalent protection available in the audio world. The PCIe bus may be defined in some Content Industry Agreements as a user accessible bus. It is further defined in some Content Industry Agreements that premium audio is not allowed to pass over a user-accessible bus in unprotected form. In spite of PC industry push-back on this requirement, it is not certain which way the decision will fall. Realistically, any concession in this area would only be valid for a small number of years, so the PC industry needs to address this issue in the not-too-distant future. Microsoft plans to address this as part of the PAP (Protected Audio Path) project that will be a number of years after the initial release of Windows Vista. When the PC industry does PAP, there will be a way of encrypting audio over the PCIe bus. For discrete graphics manufacturers, the easiest mechanism to use would be PVP, because their graphics chip hardware will already be able to decrypt this. The encryption would be done in an Output Encryption APO module in the Audio Engine in the Protected Environment. As mentioned earlier, the plan is to provide a mechanism in Windows Vista to load a future Output Encryption APO module. Even in the initial version of Windows Vista, however, a third party could write a custom Output Encryption APO module that performs PVP encryption. This would need to establish a separate session key, because there is no robust way of getting the session key from the graphics stack to the audio stack. We hope to be successful with the amendment to the content industry agreements, so that using an encrypting Output Encryption APO module can be deferred for a few years. In summary, Microsoft's PAP in Vista was left unfinished and this is likely to be the origin of the current chaotic situation of downsampled audio. Hardware and Software player Must Work Together PAP involves encryption/decryption process and requires the support by both hardware and software player, just like PVP (Protected Video Path). Quote: 5 Protected Audio Path: PAP Possible PAP Architecture Think about PAP is as a collection bucket where we store future ideas about audio content protection. Current thinking is that PAP would provide protection all the way to the codec chip that has the digital-to-analog converter that makes the sounds (*my comment: replace it by HDMI transmitter). This might include protecting over whatever physical and wireless cables are in use in that future timeframe. The most likely encryption candidate would be AES 128-bit counter mode, just like PVP. Instead of the ProtectedDXVA component doing the encryption, the encryption would be done in an Output Encryption APO in PUMA. In both the audio and video cases, the important thing is that the encryption is done inside the Protected Environment. The proposed plan is that the hardware AES engine that does the decryption would be in the codec chip. This is a harder than in the case of a graphics chip, because codecs have far fewer gates and are also more price sensitive. The desire to not over burden codec chips is a contributing factor in not pushing to introduce audio encryption quickly. Adding AES engines to codec chips would at best take many years, and might turn out not to be feasible. (*For discrete graphics manufacturers, the easiest mechanism to use would be PVP, because their graphics chip hardware will already be able to decrypt this.) Establishing a session key is the hardest problem. It is not practical for an audio codec chip to do Diffie Hellman, because there is no natural math capability as there is in the case of graphics chip programmable shaders. Providing robust hardware authentication is a big part of what PAP is about. As in the case of PVP, HFS (*Hardware Functionality Scan) can be used for hardware authentication. A codec chip is not as complex as a graphics chip, but even so there is enough sophistication that can be used in the HFS process. For PAP, the authentication would likely be done using a codec-specific user-mode authentication module that would plug into the POC component in the PUMA engine. Even though the user-mode module would be specific to a particular hardware manufacturer, the Microsoft class driver can still be used. That still leaves the problem of how to establish a session key. Tentative plans address how to extend the HFS process to also generate a key at both ends of the wire. For want of a better name, this process is called MKey. The session key established between the Output Encryption APO and the audio codec chip would be used to encrypt a content key generated by the Output Encryption APO. It is the content key that the Output Encryption APO would use to encrypt the content. As stated, the requirement to encrypt audio data is still many years away, and there is certainly no specification for how to do this yet. Having said that, Microsoft is eager to work with manufacturers of codec chips to plan for the future. PUMA (Protected User Mode Audio) Architecture Possible PAP Architecture Here is a slide created by Realtek. This is basically a simplified version of the Microsoft slide above. Protected Video Path (PVP) BTW PAP Architecture is similar to PVP (Protected Video Path) Architecture. PVP-OPM (Output Protection Management) Architecture PVP-UAB (User Accessible Bus) Architecture ______________________________________ HDMI Sound Cards &#8211; Proprietary PAP Solutions ?????????????????????????????????????? Since Microsoft is not going to finish the unfinished project PAP, several software and hardware manufacturers are developing its own protected audio path and a sound device supporting it. Right now the following two solutions are available (soon). Auzentech X-Fi HomeTheater HD and CyberLink PowerDVD - TweakTown - CyberLink Interview for the HTPC HD Fans (April 10, 2008) CyberLink said there are two reasons why they need a proprietary interface: Uncompressed audio data would be interfered by Vista OS (mixing with other audio streams, down mix and so on), which would cause incorrect results while decrypting protected data in Audio HW/Driver). Microsoft has not defined a new interface to pass new compressed audio formats supported in HDMI 1.3 (Dolby TrueHD, DTS-HD MA, DD+). The basic flow of audio (LPCM, DD+, Dolby TrueHD, DTS-HD MA) is: PowerDVD ---> Proprietary API (no WinMM/Media Foundation/DirectX/Vista Audio Engine) ---> Audio Driver ---> Audio Device (analog or HDMI) PowerDVD encrypts data and send it to the audio driver/device via a proprietary API. The audio device decrypts and Analog: renders and output it. HDMI: mux with video and output it via a HDMI transmitter/HDCP. The product is expected in Q1 2009. ASUS Xonar HDAV1.3 and ArcSoft TotalMedia Theater The following is an early report on this solution. - Computex 2008 - ASUS HDAV 1.3 Update Quote: ASUS, with assistance from C-Media and ArcSoft, has been able to adhere to the PAPS and AACS content schemes without having to downmix the audio sources (resulting in 16-bit/48kHz DVD quality audio) or even dropping support for DTS-HD and Dolby TrueHD altogether. I will leave the details to the official thread: *Official* ASUS Xonar HDAV1.3 thread _____________________________________________________ MKV and FLAC &#8211; A Solution for Full-Resolution Audio without PAP ????????????????????????????????????????????????????? You can remove AACS encryption by AnyDVD HD and create your own mkv files with full-resolution lossless audio track (FLAC) with eac3to and then play them in full quality with any of the multichannel LPCM solutions. A nice thread on this topic is here: - HD to mkv .....the options are endless!!!!</Content>
	</Post>
</Thread>
